<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p id="modal-loading-message">Processing...</p>
            </div>
        </div>
    </div>
</div>

<!-- Logs Modal -->
<div class="modal fade" id="logsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Training Logs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="logs-content" class="bg-light p-3" style="max-height: 70vh; overflow-y: auto;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="copy-logs-btn">
                    <i class="fas fa-copy me-2"></i>Copy to Clipboard
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Modal -->
<div class="modal fade" id="dashboardModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl" style="max-width: 90%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Training Dashboard</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="dashboard-image" src="" class="img-fluid" alt="Training Dashboard" style="max-width: 100%;">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirm Modal -->
<div class="modal fade" id="confirm-modal" tabindex="-1" aria-labelledby="confirm-modal-title" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirm-modal-title">Confirm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirm-modal-body">
                Are you sure you want to proceed?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirm-modal-confirm">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- File Browser Modal -->
<div class="modal fade" id="file-browser-modal" tabindex="-1" aria-labelledby="file-browser-title" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header border-bottom-0 pb-2">
                <h5 class="modal-title d-flex align-items-center" id="file-browser-title">
                    <i class="fas fa-folder-open me-2 text-primary"></i>
                    Select Directory
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body px-4 py-3">
                <!-- Navigation Bar -->
                <div class="d-flex align-items-center mb-3 gap-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="browser-up-btn" disabled
                            data-bs-toggle="tooltip" title="Go up one directory">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <div class="flex-grow-1">
                        <input type="text" class="form-control form-control-sm font-monospace" 
                               id="browser-current-path" placeholder="Enter path and press Enter to navigate..." 
                               style="border: 1px solid var(--bs-gray-300);"
                               data-bs-toggle="tooltip" title="Type a path and press Enter to navigate directly">
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="browser-open-finder-btn"
                            data-bs-toggle="tooltip" 
                            title="Open in system file manager (works only when server and client are on same machine)">
                        <i class="fas fa-external-link-alt"></i>
                    </button>
                </div>
                
                <!-- Loading State -->
                <div id="browser-loading" class="text-center py-4 d-none">
                    <div class="spinner-border spinner-border-sm text-primary mb-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mb-0 small">Loading...</p>
                </div>
                
                <!-- Content Area -->
                <div id="browser-content" class="border rounded" style="height: 350px; overflow-y: auto; background-color: var(--bs-body-bg);">
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-folder-open fa-2x mb-2 opacity-50"></i>
                        <p class="mb-0 small">Navigate to a directory</p>
                    </div>
                </div>
                
                <!-- Help Text -->
                <div class="mt-3" id="browser-help-select">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Click on folders to navigate â€¢ Double-click to select and close
                    </small>
                </div>
            </div>
            <div class="modal-footer border-top-0 pt-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="browser-select-btn" disabled>
                    <i class="fas fa-check me-1"></i> Select Directory
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Fusion Configuration Modal -->
<div class="modal fade" id="fusion-config-modal" tabindex="-1" aria-labelledby="fusion-config-title" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fusion-config-title">
                    <i class="fas fa-layer-group me-2"></i>Configure Fusion
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="fusion-config-form">
                    <div class="mb-3">
                        <label for="fusion-suffix" class="form-label">Model Suffix</label>
                        <input type="text" class="form-control" id="fusion-suffix" placeholder="e.g., _math, _it, _reasoning">
                        <div class="form-text">Optional suffix to add to the fused model name (e.g., _math, _it, _reasoning)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="fusion-description" class="form-label">Description</label>
                        <textarea class="form-control" id="fusion-description" rows="4" placeholder="Describe what this fused model is for..."></textarea>
                        <div class="form-text">Optional description that will be added to the model's README.md</div>
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Preview:</strong>
                        <div class="mt-2 p-2 bg-light rounded">
                            <code id="fusion-preview-name" class="text-break" style="word-break: break-all; white-space: pre-wrap; font-size: 0.9em;">model_name_fused_adapter_name</code>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="fusion-config-confirm">
                    <i class="fas fa-layer-group me-2"></i>Start Fusion
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Parameters Modal -->
<div class="modal fade" id="parameters-modal" tabindex="-1" aria-labelledby="parameters-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="parameters-modal-title">Session Parameters</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="parameters-modal-body">
                <!-- Parameters will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="copy-parameters-btn">
                    <i class="fas fa-copy me-2"></i>Copy to Clipboard
                </button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Hidden file input for loading chat history -->
<input type="file" id="load-history-file-input" accept=".json" style="display: none;"> 